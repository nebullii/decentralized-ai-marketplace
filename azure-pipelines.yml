trigger:
  branches:
    include:
      - main

pool:
  vmImage: 'ubuntu-latest'

jobs:
  - job: TestAndDeploy
    displayName: 'Test and Deploy'
    steps:
      - task: UsePythonVersion@0
        inputs:
          versionSpec: '3.13'
          
      - script: |
          python -m venv venv
          source venv/bin/activate
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install pytest pytest-azurepipelines pytest-cov
        displayName: 'Install Dependencies'

      - script: |
          source venv/bin/activate
          python manage.py migrate
          python manage.py test
        displayName: 'Run Tests'